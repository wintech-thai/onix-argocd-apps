apiVersion: batch/v1
kind: CronJob
metadata:
  name: onix-backup
spec:
  schedule: "0 */4 * * *" # Every 4 hours
  jobTemplate:
    spec:
      ttlSecondsAfterFinished: 600
      template:
        spec:
          containers:
          - name: onix-backkup
            image: asia-southeast1-docker.pkg.dev/its-artifact-commons/onix/onix-jobs:{{ .Values.onixBackupImageTag }}
            imagePullPolicy: IfNotPresent
            command:
            - /bin/sh
            args:
            - /scripts/backup-storage-and-db.bash
            #env:
            #- name: ES_USER
            #  value: elastic
            #- name: GOOGLE_APPLICATION_CREDENTIALS 
            #  value: /secrets/gcp-sa.json
            #- name: BUCKET_NAME
            #  value: rtarf-backup
            #- name: ES_PASSWORD
            #  valueFrom:
            #    secretKeyRef:
            #      name: es-soc-es-elastic-user
            #      key: elastic

            #volumeMounts:
            #- name: scripts
            #  mountPath: /scripts
            #- name: secrets
            #  readOnly: true
            #  mountPath: "/secrets"

          restartPolicy: OnFailure

#          volumes:
#          - name: scripts
#            configMap:
#              name: script-cm
#          - name: secrets
#            secret:
#              secretName: gcp-sa
